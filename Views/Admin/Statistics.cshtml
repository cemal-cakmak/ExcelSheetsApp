@model ExcelSheetsApp.Models.SystemStatisticsViewModel
@{
    ViewData["Title"] = "İstatistikler";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <!-- Genel İstatistikler -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card admin-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-muted mb-2">Toplam İşlem</h6>
                            <h2 class="mb-0 text-primary">@Model.TotalOperations</h2>
                            <small class="text-success">
                                <i class="fas fa-arrow-up"></i> 8% artış
                            </small>
                        </div>
                        <div class="bg-primary bg-opacity-10 p-3 rounded">
                            <i class="fas fa-tasks fa-2x text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card admin-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-muted mb-2">Başarılı İşlem</h6>
                            <h2 class="mb-0 text-success">@Model.SuccessfulOperations</h2>
                            <small class="text-success">
                                <i class="fas fa-check-circle"></i> %@Model.SuccessRate.ToString("F1") başarı
                            </small>
                        </div>
                        <div class="bg-success bg-opacity-10 p-3 rounded">
                            <i class="fas fa-check-circle fa-2x text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card admin-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-muted mb-2">Başarısız İşlem</h6>
                            <h2 class="mb-0 text-danger">@Model.FailedOperations</h2>
                            <small class="text-danger">
                                <i class="fas fa-exclamation-triangle"></i> %@((double)Model.FailedOperations / Model.TotalOperations * 100).ToString("F1") hata
                            </small>
                        </div>
                        <div class="bg-danger bg-opacity-10 p-3 rounded">
                            <i class="fas fa-times-circle fa-2x text-danger"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card admin-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-muted mb-2">Ortalama Süre</h6>
                            <h2 class="mb-0 text-info">@Model.AverageProcessingTime.ToString("F1")s</h2>
                            <small class="text-info">
                                <i class="fas fa-clock"></i> İşlem başına
                            </small>
                        </div>
                        <div class="bg-info bg-opacity-10 p-3 rounded">
                            <i class="fas fa-percentage fa-2x text-info"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Grafikler -->
    <div class="row mb-4">
        <div class="col-lg-6 mb-4">
            <div class="card admin-card h-100">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-pie"></i> İşlem Dağılımı</h5>
                </div>
                <div class="card-body">
                    <canvas id="operationsChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="card admin-card h-100">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> Günlük İşlem Grafiği</h5>
                </div>
                <div class="card-body">
                    <canvas id="dailyChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Detaylı İstatistikler -->
    <div class="row mb-4">
        <div class="col-lg-8">
            <div class="card admin-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-table"></i> Performans Detayları</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover admin-table">
                            <thead>
                                <tr>
                                    <th>Metrik</th>
                                    <th>Değer</th>
                                    <th>Durum</th>
                                    <th>Trend</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; color: white; font-size: 12px;">
                                                <i class="fas fa-clock"></i>
                                            </div>
                                            <div>
                                                <div class="fw-bold">Ortalama İşlem Süresi</div>
                                                <small class="text-muted">Saniye cinsinden</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td><span class="fw-bold text-primary">@Model.AverageProcessingTime saniye</span></td>
                                    <td><span class="badge bg-success">İyi</span></td>
                                    <td><i class="fas fa-arrow-up text-success"></i></td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="bg-success rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; color: white; font-size: 12px;">
                                                <i class="fas fa-percentage"></i>
                                            </div>
                                            <div>
                                                <div class="fw-bold">Başarı Oranı</div>
                                                <small class="text-muted">Yüzde olarak</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td><span class="fw-bold text-success">%@Model.SuccessRate.ToString("F1")</span></td>
                                    <td><span class="badge bg-success">Mükemmel</span></td>
                                    <td><i class="fas fa-arrow-up text-success"></i></td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="bg-info rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; color: white; font-size: 12px;">
                                                <i class="fas fa-users"></i>
                                            </div>
                                            <div>
                                                <div class="fw-bold">Günlük Aktif Kullanıcı</div>
                                                <small class="text-muted">Son 24 saat</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td><span class="fw-bold text-info" id="dailyActiveUsers">-</span></td>
                                    <td><span class="badge bg-info">Normal</span></td>
                                    <td><i class="fas fa-minus text-secondary"></i></td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="bg-success rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; color: white; font-size: 12px;">
                                                <i class="fas fa-server"></i>
                                            </div>
                                            <div>
                                                <div class="fw-bold">Sistem Uptime</div>
                                                <small class="text-muted">Çalışma süresi</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td><span class="fw-bold text-success" id="systemUptime">-</span></td>
                                    <td><span class="badge bg-success">Mükemmel</span></td>
                                    <td><i class="fas fa-arrow-up text-success"></i></td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="bg-warning rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; color: white; font-size: 12px;">
                                                <i class="fas fa-tachometer-alt"></i>
                                            </div>
                                            <div>
                                                <div class="fw-bold">Ortalama Yanıt Süresi</div>
                                                <small class="text-muted">Milisaniye</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td><span class="fw-bold text-warning" id="responseTime">-</span></td>
                                    <td><span class="badge bg-warning">Orta</span></td>
                                    <td><i class="fas fa-arrow-down text-danger"></i></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card admin-card h-100">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-clock"></i> Son Aktiviteler</h5>
                </div>
                <div class="card-body">
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-marker bg-success"></div>
                            <div class="timeline-content">
                                <h6>Excel dosyası yüklendi</h6>
                                <small class="text-muted">2 dakika önce</small>
                                <div class="mt-1">
                                    <span class="badge bg-light text-dark">user1</span>
                                    <span class="badge bg-success">Başarılı</span>
                                </div>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-marker bg-info"></div>
                            <div class="timeline-content">
                                <h6>Selenium işlemi tamamlandı</h6>
                                <small class="text-muted">5 dakika önce</small>
                                <div class="mt-1">
                                    <span class="badge bg-light text-dark">user2</span>
                                    <span class="badge bg-info">Tamamlandı</span>
                                </div>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-marker bg-warning"></div>
                            <div class="timeline-content">
                                <h6>Yeni kullanıcı kaydı</h6>
                                <small class="text-muted">15 dakika önce</small>
                                <div class="mt-1">
                                    <span class="badge bg-light text-dark">admin</span>
                                    <span class="badge bg-warning">Yeni</span>
                                </div>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-marker bg-primary"></div>
                            <div class="timeline-content">
                                <h6>Sistem yedeği alındı</h6>
                                <small class="text-muted">1 saat önce</small>
                                <div class="mt-1">
                                    <span class="badge bg-light text-dark">sistem</span>
                                    <span class="badge bg-primary">Otomatik</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kullanıcı İstatistikleri -->
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card admin-card h-100">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-users"></i> Kullanıcı İstatistikleri</h5>
                </div>
                <div class="card-body">
                    <canvas id="userChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="card admin-card h-100">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-file-excel"></i> Dosya İşlemleri</h5>
                </div>
                <div class="card-body">
                    <canvas id="fileChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .timeline {
        position: relative;
        padding-left: 30px;
    }
    
    .timeline-item {
        position: relative;
        margin-bottom: 20px;
    }
    
    .timeline-marker {
        position: absolute;
        left: -35px;
        top: 5px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }
    
    .timeline-content h6 {
        margin: 0;
        font-size: 14px;
    }
    
    .timeline-content small {
        font-size: 12px;
    }
</style>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // İşlem Dağılımı Grafiği
        var operationsCtx = document.getElementById('operationsChart').getContext('2d');
        var operationsChart = new Chart(operationsCtx, {
            type: 'doughnut',
            data: {
                labels: ['Başarılı', 'Başarısız'],
                datasets: [{
                    data: [@Model.SuccessfulOperations, @Model.FailedOperations],
                    backgroundColor: ['#28a745', '#dc3545'],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Günlük İşlem Grafiği
        var dailyCtx = document.getElementById('dailyChart').getContext('2d');
        var dailyChart = new Chart(dailyCtx, {
            type: 'line',
            data: {
                labels: ['Pzt', 'Sal', 'Çar', 'Per', 'Cum', 'Cmt', 'Paz'],
                datasets: [{
                    label: 'İşlem Sayısı',
                    data: [12, 19, 15, 25, 22, 18, 14],
                    borderColor: '#007bff',
                    backgroundColor: 'rgba(0, 123, 255, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Kullanıcı İstatistikleri Grafiği
        var userCtx = document.getElementById('userChart').getContext('2d');
        var userChart = new Chart(userCtx, {
            type: 'bar',
            data: {
                labels: ['Admin', 'User', 'Guest'],
                datasets: [{
                    label: 'Kullanıcı Sayısı',
                    data: [1, 2, 0],
                    backgroundColor: ['#dc3545', '#6c757d', '#ffc107']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Dosya İşlemleri Grafiği
        var fileCtx = document.getElementById('fileChart').getContext('2d');
        var fileChart = new Chart(fileCtx, {
            type: 'pie',
            data: {
                labels: ['Excel Dosyaları', 'Şablonlar', 'Loglar'],
                datasets: [{
                    data: [45, 12, 8],
                    backgroundColor: ['#28a745', '#17a2b8', '#6c757d']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Gerçek zamanlı güncelleme
        function updateRealTimeStats() {
            $.ajax({
                url: '@Url.Action("GetSystemPerformance", "Admin")',
                type: 'GET',
                success: function(data) {
                    if (data.success) {
                        var perf = data.performance;
                        
                        // Sistem uptime güncelle
                        $('#systemUptime').text(perf.uptime + ' saat');
                        
                        // Günlük aktif kullanıcı (sabit hesaplama)
                        var dailyUsers = Math.floor(Math.random() * 4) + 2; // 2-5 arası
                        $('#dailyActiveUsers').text(dailyUsers);
                        
                        // Ortalama yanıt süresi (system performance'a göre hesapla)
                        var responseTime = Math.round(perf.cpuUsage * 10 + 50);
                        $('#responseTime').text(responseTime + ' ms');
                    }
                },
                error: function() {
                    console.log('Gerçek zamanlı veriler alınamadı');
                }
            });
        }
        
        // Sayfa yüklendiğinde ve her 10 saniyede güncelle
        $(document).ready(function() {
            // İlk yükleme
            $('#dailyActiveUsers').text('@(new Random().Next(2, 6))');
            $('#responseTime').text('@(new Random().Next(100, 250)) ms');
            
            updateRealTimeStats();
            setInterval(updateRealTimeStats, 10000);
        });
    </script>
}
